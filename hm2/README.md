

# JSON-API без Spring

Требование к проекту:
1. Связи n-to-n, 1-to-n
2. Минимум 3 таблицы 
3. Java Servlets 


# Предметная область. 

Device tracker. Прилоложение хранит информацию об активности устройств.
На устройстве запущен скрипт который переодидично высылает
ping-запрос на сервис, из чего сервис делает вывод, что девайс в сети.
Позже можно посмотреть аналитику, когда девайс использовался.

User, Device, PingReport
User has many Devices
Device has many PingReports

Авторизация? не будет


Ресурсы:
  /api/user
  /api/device
  /api/reports 


# План работ

- [x] Проектирование базы данных (смотри db.changelog-master.yaml)
- [x] Настройка Liquibase
- [x] Написание миграций Liquibase

- [x] UserRepositoryImpl
- [x] Выбор стратегии и инструментов тестирование data access layer (никак не тестировать)
- [x] Свой IoC контейнер
- [x] UserService
- [x] UserController (CRUD)


## Проектирование базы данных

3 сущности:
1. Пользователь
table app_user


## Как же всё-таки тестировать DAL?

База данных:
  1. Какая-нибудь H2
  2. Postres в связке в Testcontainers
  3. Локальная Postgres


|                | Плюсы                                                 | Минусы                       |
| -------------- | ----------------------------------------------------- | ---------------------------- |
| H2             | Производительность тестирования, легкая развертывание | Не самые показательные тесты |
| Testcontainers | Легкое развертывание                                  | Плохая производительность    |
| Local Postres  | Простота реализации тестов                            | Нет переносимости            |


Не очевидные вопросы:
  1. Как создавать базу данных для тестирования?
  2. Как заставить liquibase создать скрипт инициализации


Итого, проводить unit тестирование DAL в таком проекте - страдания
Будут интеграционные тесты, да и то самые поверхностные
